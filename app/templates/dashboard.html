<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CRM Pro v2.5 Cyberpunk</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-headset"></i> CRM Pro</h2>
            </div>
            <ul class="nav-links">
                <li><a href="/" class="active"><i class="fas fa-dashboard"></i> Dashboard</a></li>
                <li><a href="/tickets"><i class="fas fa-ticket-alt"></i> Ticket</a></li>
                <li><a href="/customers"><i class="fas fa-users"></i> Clienti</a></li>
                <li><a href="/settings"><i class="fas fa-cogs"></i> Impostazioni</a></li>
                <li><a href="/reports"><i class="fas fa-chart-bar"></i> Report</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <header class="top-header">
                <h1>COMMAND CENTER</h1>
                <div class="header-right">
                    <!-- System Status HUD -->
                    <div class="system-hud">
                        <div class="hud-item">
                            <div class="hud-indicator active" id="system-status"></div>
                            <span>SYS</span>
                        </div>
                        <div class="hud-item">
                            <div class="hud-indicator active" id="db-status"></div>
                            <span>DB</span>
                        </div>
                        <div class="hud-item">
                            <div class="hud-indicator active" id="net-status"></div>
                            <span>NET</span>
                        </div>
                    </div>
                    
                    <!-- Real-time Clock -->
                    <div class="cyber-clock">
                        <div id="current-time" class="time-display"></div>
                        <div class="time-label">SYSTEM TIME</div>
                    </div>
                    
                    <!-- Theme Toggle -->
                    <button class="theme-toggle" title="Switch Theme">
                        <i class="fas fa-sun"></i>
                        <span>Light Mode</span>
                    </button>
                    
                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="btn primary btn-sm" onclick="openNewTicketModal()">
                            <i class="fas fa-plus"></i> TICKET
                        </button>
                        <button class="btn secondary btn-sm" onclick="openNewCustomerModal()">
                            <i class="fas fa-user-plus"></i> CLIENT
                        </button>
                    </div>
                    
                    <div class="user-display"></div>
                    <button class="logout-btn" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </header>

            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon open">
                        <i class="fas fa-ticket-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="open-tickets">0</h3>
                        <p>Ticket Aperti</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon closed">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="closed-tickets">0</h3>
                        <p>Ticket Chiusi</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon total">
                        <i class="fas fa-list"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-tickets">0</h3>
                        <p>Totale Ticket</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon agents">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-agents">0</h3>
                        <p>Agenti Attivi</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-content">
                <div class="recent-tickets">
                    <h2>Ticket Recenti</h2>
                    <div class="ticket-list" id="recent-tickets-list">
                        <div class="loading">Caricamento...</div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h2>Azioni Rapide</h2>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="openNewTicketModal()">
                            <i class="fas fa-plus"></i> Nuovo Ticket
                        </button>
                        <button class="action-btn secondary" onclick="openNewCustomerModal()">
                            <i class="fas fa-user-plus"></i> Nuovo Cliente
                        </button>
                        <button class="action-btn info">
                            <i class="fas fa-download"></i> Export Data
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Nuovo Ticket -->
    <div id="newTicketModal" class="modal modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus"></i> Nuovo Ticket</h2>
                <span class="close" onclick="closeModal('newTicketModal')">&times;</span>
            </div>
            <div class="modal-body">
            <form id="ticketForm">
                <div class="new-ticket-form-container">
                    <!-- Colonna sinistra - Cliente e Dettagli principali del ticket -->
                    <div class="new-ticket-form-left">
                        <h4 style="color: #dc3545; border-bottom: 2px solid #dc3545; padding-bottom: 5px;">
                            <i class="fas fa-user"></i> Cliente
                        </h4>
                        
                        <div class="customer-selection">
                            <div class="form-group">
                                <fieldset>
                                    <legend>Tipo Cliente:</legend>
                                    <div class="customer-choice">
                                        <label class="radio-option" for="customerTypeExisting">
                                            <input type="radio" id="customerTypeExisting" name="customerType" value="existing" checked onchange="toggleCustomerType()">
                                            <span>Cliente esistente</span>
                                        </label>
                                        <label class="radio-option" for="customerTypeNew">
                                            <input type="radio" id="customerTypeNew" name="customerType" value="new" onchange="toggleCustomerType()">
                                            <span>Nuovo cliente</span>
                                        </label>
                                    </div>
                                </fieldset>
                            </div>
                            
                            <div id="existingCustomerSection">
                                <div class="form-group">
                                    <label for="existingCustomer">Seleziona Cliente:</label>
                                    <select id="existingCustomer" onchange="onCustomerSelect()">
                                        <option value="">-- Seleziona un cliente --</option>
                                    </select>
                                </div>
                                <div id="selectedCustomerInfo" class="customer-info-display" style="display: none;">
                                    <div class="info-card">
                                        <h4>Cliente Selezionato:</h4>
                                        <div id="customerInfoContent"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="newCustomerSection" style="display: none;">
                                <div class="form-group">
                                    <label for="dashboardCustomerName">Nome Cliente:</label>
                                    <input type="text" id="dashboardCustomerName">
                                </div>
                                <div class="form-group">
                                    <label for="dashboardCustomerEmail">Email Cliente:</label>
                                    <input type="email" id="dashboardCustomerEmail">
                                </div>
                                <div class="form-group">
                                    <label for="dashboardCustomerPhone">Telefono (opzionale):</label>
                                    <input type="tel" id="dashboardCustomerPhone">
                                </div>
                                <div class="form-group">
                                    <label for="customerCompanyTicket">Azienda (opzionale):</label>
                                    <input type="text" id="customerCompanyTicket">
                                </div>
                            </div>
                        </div>
                        
                        <hr style="margin: 20px 0; border: 1px solid #eee;">
                        <h4 style="color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 5px;">
                            <i class="fas fa-edit"></i> Dettagli Ticket
                        </h4>
                        
                        <div class="form-group">
                            <label for="ticketTitle">Titolo Ticket:</label>
                            <input type="text" id="ticketTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="ticketDescription">Descrizione:</label>
                            <textarea id="ticketDescription" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="ticketPriority">Priorità:</label>
                            <select id="ticketPriority">
                                <option value="Low">Bassa</option>
                                <option value="Medium" selected>Media</option>
                                <option value="High">Alta</option>
                                <option value="Urgent">Urgente</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn-submit">Crea Ticket</button>
                    </div>
                    
                    <!-- Colonna destra - Campi di gestione -->
                    <div class="new-ticket-form-right">
                        <h4 style="color: #28a745; border-bottom: 2px solid #28a745; padding-bottom: 5px;">
                            <i class="fas fa-cogs"></i> Classificazione e Gestione
                        </h4>
                        
                        <div class="form-group">
                            <label for="newTicketSoftware"><i class="fas fa-desktop"></i> Software:</label>
                            <select id="newTicketSoftware">
                                <option value="">-- Seleziona Software --</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="newTicketGroup"><i class="fas fa-users"></i> Gruppo:</label>
                            <select id="newTicketGroup">
                                <option value="">-- Seleziona Gruppo --</option>
                            </select>
                        </div>
                        
                        
                        <div class="form-group">
                            <label for="newTicketType"><i class="fas fa-tag"></i> Tipo:</label>
                            <select id="newTicketType">
                                <option value="">-- Seleziona Tipo --</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="newAssignedToAgent"><i class="fas fa-user-tie"></i> Agente Assegnato:</label>
                            <select id="newAssignedToAgent">
                                <option value="">-- Seleziona Agente --</option>
                            </select>
                        </div>
                        
                        <hr style="margin: 20px 0; border: 1px solid #eee;">
                        <h5 style="color: #dc3545;">
                            <i class="fas fa-edit"></i> Campi Assistenza (Opzionali)
                        </h5>
                        
                        <div class="form-group">
                            <label for="newRapportoDanea"><i class="fas fa-file-alt"></i> Rapporto Danea:</label>
                            <input type="text" id="newRapportoDanea" placeholder="es: RPT-2025-001">
                        </div>
                        
                        <div class="form-group">
                            <label for="newIdAssistenza"><i class="fas fa-id-card"></i> ID Assistenza:</label>
                            <input type="text" id="newIdAssistenza" placeholder="es: ASS-12345">
                        </div>
                        
                        <div class="form-group">
                            <label for="newPasswordTeleassistenza"><i class="fas fa-key"></i> Password Teleassistenza:</label>
                            <input type="text" id="newPasswordTeleassistenza" placeholder="es: TEMP123">
                        </div>
                        
                        <div class="form-group">
                            <label for="newNumeroRichiestaTeleassistenza"><i class="fas fa-phone"></i> Numero Richiesta Teleassistenza:</label>
                            <input type="text" id="newNumeroRichiestaTeleassistenza" placeholder="es: REQ-789">
                        </div>
                    </div>
                </div>
            </form>
            </div>
        </div>
    </div>

    <!-- Modal Nuovo Cliente -->
    <div id="newCustomerModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('newCustomerModal')">&times;</span>
            <h2>Nuovo Cliente</h2>
            <form id="customerForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerName">Nome *:</label>
                        <input type="text" id="customerName" required>
                    </div>
                    <div class="form-group">
                        <label for="customerEmail">Email *:</label>
                        <input type="email" id="customerEmail" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerPhone">Telefono:</label>
                        <input type="tel" id="customerPhone">
                    </div>
                    <div class="form-group">
                        <label for="customerCompany">Azienda:</label>
                        <input type="text" id="customerCompany">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="customerAddress">Indirizzo:</label>
                    <textarea id="customerAddress" rows="2"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="customerNotes">Note:</label>
                    <textarea id="customerNotes" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="customerStatus">Stato:</label>
                    <select id="customerStatus">
                        <option value="Active">Attivo</option>
                        <option value="Inactive">Inattivo</option>
                        <option value="Prospect">Prospect</option>
                    </select>
                </div>
                
                <button type="submit" class="btn-submit">Aggiungi Cliente</button>
            </form>
        </div>
    </div>

    <!-- Modal Dettagli Ticket -->
    <div id="ticketDetailsModal" class="modal modal-ticket-details modal-fullscreen">
        <div class="modal-content fullscreen-content">
            <div class="modal-header">
                <h2><i class="fas fa-eye"></i> Visualizza Ticket</h2>
                <span class="close" onclick="closeModal('ticketDetailsModal')">&times;</span>
            </div>
            <div class="modal-body-two-column">
                <!-- Chat Section - LEFT EXPANDED -->
                <div class="chat-main-area">
                    <!-- Ticket Header Section -->
                    <div class="ticket-header-section">
                        <div class="ticket-problem-overview">
                            <h3 id="ticketProblemTitle">Titolo del Problema</h3>
                            <div class="ticket-problem-description">
                                <p id="ticketProblemDescription">Descrizione della problematica...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Section -->
                    <div class="ticket-chat-section">
                        <div class="chat-header">
                            <h4><i class="fas fa-comments"></i> Conversazione</h4>
                            <div class="chat-controls">
                                <button type="button" class="btn btn-sm secondary" onclick="refreshTicketMessages()">
                                    <i class="fas fa-sync-alt"></i> Aggiorna
                                </button>
                            </div>
                        </div>
                        <div class="chat-container">
                            <div id="ticketMessages" class="chat-messages">
                                <!-- Messages will be populated by JavaScript -->
                            </div>
                            <div class="chat-input-section">
                                <form id="messageForm" onsubmit="sendTicketMessage(event, currentTicketId)">
                                    <div class="message-input-group">
                                        <textarea id="messageText" placeholder="Scrivi un messaggio..." rows="3" required></textarea>
                                        <div class="message-controls">
                                            <label class="internal-note-checkbox" for="isInternalMessage">
                                                <input type="checkbox" id="isInternalMessage">
                                                <span>Nota interna (solo agenti)</span>
                                            </label>
                                            <button type="submit" class="btn primary">
                                                <i class="fas fa-paper-plane"></i> Invia
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Details sidebar - RIGHT COLUMN -->
                <div class="details-sidebar-right">
                    <div class="sidebar-header">
                        <h3><i class="fas fa-info-circle"></i> Dettagli</h3>
                    </div>
                    <div class="sidebar-body">
                        <div id="ticketDetailsContent">
                            <!-- Compact details will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Modifica Ticket -->
    <div id="editTicketModal" class="modal modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Modifica Ticket</h2>
                <span class="close" onclick="closeModal('editTicketModal')">&times;</span>
            </div>
            <div class="modal-body">
            <form id="editTicketForm">
                <input type="hidden" id="editTicketId">
                
                <div class="new-ticket-form-container">
                    <!-- Colonna sinistra - Campi principali -->
                    <div class="new-ticket-form-left">
                        <h4 style="color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 5px;">
                            <i class="fas fa-edit"></i> Dettagli Ticket
                        </h4>
                        
                        <div class="form-group">
                            <label for="editTicketTitle">Titolo:</label>
                            <input type="text" id="editTicketTitle" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editTicketDescription">Descrizione:</label>
                            <textarea id="editTicketDescription" rows="4" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="editCustomerName">Nome Cliente:</label>
                            <input type="text" id="editCustomerName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editCustomerEmail">Email Cliente:</label>
                            <input type="email" id="editCustomerEmail" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editTicketPriority">Priorità:</label>
                            <select id="editTicketPriority">
                                <option value="Low">Bassa</option>
                                <option value="Medium">Media</option>
                                <option value="High">Alta</option>
                                <option value="Urgent">Urgente</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Colonna destra - Campi di gestione -->
                    <div class="new-ticket-form-right">
                        <h4 style="color: #28a745; border-bottom: 2px solid #28a745; padding-bottom: 5px;">
                            <i class="fas fa-cogs"></i> Classificazione e Gestione
                        </h4>
                        
                        <div class="form-group">
                            <label for="editTicketSoftware"><i class="fas fa-desktop"></i> Software:</label>
                            <select id="editTicketSoftware">
                                <option value="">-- Seleziona Software --</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editTicketGroup"><i class="fas fa-users"></i> Gruppo:</label>
                            <select id="editTicketGroup">
                                <option value="">-- Seleziona Gruppo --</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editTicketType"><i class="fas fa-tag"></i> Tipo:</label>
                            <select id="editTicketType">
                                <option value="">-- Seleziona Tipo --</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editAssignedToAgent"><i class="fas fa-user-tie"></i> Agente:</label>
                            <select id="editAssignedToAgent">
                                <option value="">-- Non assegnato --</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editTicketStatus"><i class="fas fa-info-circle"></i> Stato:</label>
                            <select id="editTicketStatus">
                                <option value="Open">Aperto</option>
                                <option value="In Progress">In Corso</option>
                                <option value="Resolved">Risolto</option>
                                <option value="Closed">Chiuso</option>
                            </select>
                        </div>
                        
                        <hr style="margin: 20px 0; border: 1px solid #eee;">
                        <h5 style="color: #dc3545;">
                            <i class="fas fa-edit"></i> Campi Assistenza (Opzionali)
                        </h5>
                        
                        <div class="form-group">
                            <label for="editRapportoDanea"><i class="fas fa-file-alt"></i> Rapporto Danea:</label>
                            <input type="text" id="editRapportoDanea" placeholder="es: RPT-2025-001">
                        </div>
                        
                        <div class="form-group">
                            <label for="editIdAssistenza"><i class="fas fa-id-card"></i> ID Assistenza:</label>
                            <input type="text" id="editIdAssistenza" placeholder="es: ASS-12345">
                        </div>
                        
                        <div class="form-group">
                            <label for="editPasswordTeleassistenza"><i class="fas fa-key"></i> Password Teleassistenza:</label>
                            <input type="text" id="editPasswordTeleassistenza" placeholder="es: TEMP123">
                        </div>
                        
                        <div class="form-group">
                            <label for="editNumeroRichiestaTeleassistenza"><i class="fas fa-phone"></i> Numero Richiesta Teleassistenza:</label>
                            <input type="text" id="editNumeroRichiestaTeleassistenza" placeholder="es: REQ-789">
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn-submit">Aggiorna Ticket</button>
            </form>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
    <script src="/static/js/tickets.js"></script>
</body>
</html>